<!DOCTYPE html>
<html lang="en">
<head>
	<title></title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
<!--===============================================================================================-->	
	<link rel="icon" type="image/png" href="images/icons/favicon.ico"/>
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/bootstrap/css/bootstrap.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="fonts/font-awesome-4.7.0/css/font-awesome.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="fonts/Linearicons-Free-v1.0.0/icon-font.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/animate/animate.css">
<!--===============================================================================================-->	
	<link rel="stylesheet" type="text/css" href="vendor/css-hamburgers/hamburgers.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/animsition/css/animsition.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/select2/select2.min.css">
<!--===============================================================================================-->	
	<link rel="stylesheet" type="text/css" href="vendor/daterangepicker/daterangepicker.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="css/util.css">
	<link rel="stylesheet" type="text/css" href="css/main.css">
<!--===============================================================================================-->
</head>
<body>
	
	<div class="">
		<div class="container-login100">
			<div class="wrap-login100 p-l-110 p-r-110 p-t-62 p-b-33">
				<form class="login100-form validate-form flex-sb flex-w">
					<span class="login100-form-title p-b-53">
						Đăng Nhập Với
					</span>

					<a id="a-sign-in-facebook" href="#" class="btn-face m-b-20">
						Facebook
					</a>

					<a id="a-sign-in-google" href="#" class="btn-google m-b-20">
						Google
					</a>
					
					<div class="p-t-31 p-b-9">
						<span class="txt1">
							Số điện thoại
						</span>
					</div>
					<div class="wrap-input100 validate-input" data-validate = "Trống">
						<input id="ip-phonenumber" class="input100" type="text" name="phonenumber" >
						<span class="focus-input100"></span>
					</div>
					
					<div class="p-t-13 p-b-9">
						<span class="txt1">
							Mật khẩu
						</span>

						
					</div>
					<div class="wrap-input100 validate-input" data-validate = "Trống">
						<input id="ip-password" class="input100" type="password" name="password" >
						<span class="focus-input100"></span>
					</div>

					<div class="container-login100-form-btn m-t-17">
						<a id="a-sign-in" class="login100-form-btn" href="#">Dang Nhap</a>
					</div>
					
					<div class="w-full text-center p-t-55">
						<a id="a-forget-password" href="#" class="txt2 bo1 m-l-5">
							Quên mật khẩu?
						</a> <br>
						<span class="txt2">
							Chưa có tài khoản?
						</span>

						<a href="signup.html" class="txt2 bo1">
							Đăng ký
						</a>
					</div>
				</form>
			</div>
		</div>
	</div>
	

	<div id="dropDownSelect1"></div>
	
<!--===============================================================================================-->
	<script src="vendor/jquery/jquery-3.2.1.min.js"></script>
<!--===============================================================================================-->
	<script src="vendor/animsition/js/animsition.min.js"></script>
<!--===============================================================================================-->
	<script src="vendor/bootstrap/js/popper.js"></script>
	<script src="vendor/bootstrap/js/bootstrap.min.js"></script>
<!--===============================================================================================-->
	<script src="vendor/select2/select2.min.js"></script>
<!--===============================================================================================-->
	<script src="vendor/daterangepicker/moment.min.js"></script>
	<script src="vendor/daterangepicker/daterangepicker.js"></script>
<!--===============================================================================================-->
	<script src="vendor/countdowntime/countdowntime.js"></script>
<!--===============================================================================================-->
	<script src="js/main.js"></script>
	
	<script src="https://www.gstatic.com/firebasejs/5.5.8/firebase.js"></script>
	<script src="https://www.gstatic.com/firebasejs/5.5.5/firebase-app.js"></script>
	<script src="https://www.gstatic.com/firebasejs/5.5.5/firebase-firestore.js"></script>
	<!-- Add additional services that you want to use -->
	<script src="https://www.gstatic.com/firebasejs/5.5.8/firebase-auth.js"></script>
	<script src="https://www.gstatic.com/firebasejs/5.5.8/firebase-database.js"></script>
	<script src="https://www.gstatic.com/firebasejs/5.5.8/firebase-firestore.js"></script>
	<script src="https://www.gstatic.com/firebasejs/5.5.8/firebase-messaging.js"></script>
	<script src="https://www.gstatic.com/firebasejs/5.5.8/firebase-functions.js"></script>

	
	<script>
	  // Initialize Firebase
	  var config = {
		apiKey: "AIzaSyCL6AJVue-xzCgoEglsq6AqIaQ6wa7ckGU",
		authDomain: "ar-menu-lvtn.firebaseapp.com",
		databaseURL: "https://ar-menu-lvtn.firebaseio.com",
		projectId: "ar-menu-lvtn",
		storageBucket: "ar-menu-lvtn.appspot.com",
		messagingSenderId: "268182650410"
	  };
	  firebase.initializeApp(config);
		
		// Initialize Cloud Firestore through Firebase
		var db = firebase.firestore();

		// Disable deprecated features
		db.settings({
		  timestampsInSnapshots: true
		});
		
		// Create a reference to the cities collection
		var usersRef = db.collection("users");
		
		function setCookie(cname,cvalue,exdays) {
			var d = new Date();
			d.setTime(d.getTime() + (exdays*24*60*60*1000));
			var expires = "expires=" + d.toGMTString();
			document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
		}
		
		function getCookie(cname) {
			var name = cname + "=";
			var decodedCookie = decodeURIComponent(document.cookie);
			var ca = decodedCookie.split(';');
			for(var i = 0; i < ca.length; i++) {
				var c = ca[i];
				while (c.charAt(0) == ' ') {
					c = c.substring(1);
				}
				if (c.indexOf(name) == 0) {
					return c.substring(name.length, c.length);
				}
			}
			return "";
		}
		
		function checkCookie() {
			var user=getCookie("uid");
			if (user != "") {
				alert("Welcome again " + user);
			} else {
				alert("Vui long dn");
			}
		}	
	</script>
	
	<script>
		// When click the sign up button
		document.getElementById("a-sign-in-facebook").addEventListener("click", signInWithFacebook);
		document.getElementById("a-sign-in-google").addEventListener("click", signInWithGoogle);
		document.getElementById("a-sign-in").addEventListener("click", checkAccount);
		document.getElementById("a-forget-password").addEventListener("click", checkCookie);
		
		// Create a reference to the cities collection
		var usersRef = db.collection("users");
		
		<!--Kiem tra thong tin dang nhap-->
		function checkAccount() {
    		let pn = "+84" + document.getElementById("ip-phonenumber").value.slice(1);
			let pw = document.getElementById("ip-password").value;
			if ( pn && pw ) {
				showPopup("Dang kiem tra");
				
				usersRef.where("user_id", "==", pn).where("user_password", "==", pw)
					.get()
					.then(
						function(querySnapshot) {
							//Check if the document you specified actually exists.
							if (querySnapshot.size > 0) {
								// do something with the data
								setCookie("uid", pn, 30);
								window.location.href = "index.html";
							} else {
								showPopup("Thông tin đăng nhập chưa chính xác. Vui lòng thử lại.");
							}
						}
					)
					.catch(
						function(error) {
							showPopup("Error getting document:", error);
						}
					);
			} else {
				showPopup("Vui long nhap day du thong tin");
			}
		}
		
		// Dang ky tai khoan
		function addUser(email,name, token) {
			// Add a new document in collection "cities"
			usersRef.doc(email).set({
				user_email: email,
				user_name: name,
				user_token_fb: token
			})
			.then(function() {
				window.location.href = "index.html";
			})
			.catch(function(error) {
				showPopup("Error writing document");
			});
		}
		
		function signInWithFacebook() {
			showPopup("Đăng nhập với Facebook");
			var provider = new firebase.auth.FacebookAuthProvider();
			firebase.auth().useDeviceLanguage();
			firebase.auth().signInWithPopup(provider).then(function(result) {
			  // This gives you a Facebook Access Token. You can use it to access the Facebook API.
			  var token = result.credential.accessToken;
			  // The signed-in user info.
			  var user = result.user;
			  var email = user.email;
			  var name = user.displayName;
			var uid = user.uid;
				usersRef.where("user_email", "==", email)
						.get()
						.then(
							function(querySnapshot) {
								//Check if the document you specified actually exists.
								if (querySnapshot.size > 0) {
									// do something with the data
									showPopup("Đăng nhập với Facebook thành công. Đang chuyển trang.");
									setCookie("uid", uid, 30);
									window.location.href = "index.html";
								} else {
									showPopup("Đang khởi tạo tài khoản.");
									addUser(email, name, token);
								}
								setCookie("uid", uid, 30);
							}
						)
						.catch(
							function(error) {
								showPopup("Error getting document:", error);
							}
						);
			
	
			}).catch(function(error) {
			  // Handle Errors here.
			  var errorCode = error.code;
			  var errorMessage = error.message;
			  // The email of the user's account used.
			  var email = error.email;
			  // The firebase.auth.AuthCredential type that was used.
			  var credential = error.credential;
			  //showPopup(errorMessage);
				setCookie("uid", pn, 30);
				window.location.href = "index.html";
			});
		}
		
		function signInWithGoogle() {
			showPopup("Đăng nhập với Google");
			var provider = new firebase.auth.GoogleAuthProvider();
			firebase.auth().useDeviceLanguage();
			firebase.auth().signInWithPopup(provider).then(function(result) {
			  // This gives you a Facebook Access Token. You can use it to access the Facebook API.
			  var token = result.credential.accessToken;
			  // The signed-in user info.
			  var user = result.user;
			  var email = user.email;
			  var name = user.displayName;
				var uid = user.uid;
				usersRef.where("user_email", "==", email)
						.get()
						.then(
							function(querySnapshot) {
								//Check if the document you specified actually exists.
								if (querySnapshot.size > 0) {
									// do something with the data
									showPopup("Đăng nhập với Google thành công. Đang chuyển trang.");
									setCookie("name", name, 30);
									setCookie("email", email, 30);
									window.location.href = "index.html";
								} else {
									showPopup("Đang khởi tạo tài khoản.");
									addUser(email, name, token);
								}
								setCookie("uid", uid, 30);
							}
						)
						.catch(
							function(error) {
								showPopup("Error getting document:", error);
							}
						);
			
	
			}).catch(function(error) {
			  // Handle Errors here.
			  var errorCode = error.code;
			  var errorMessage = error.message;
			  // The email of the user's account used.
			  var email = error.email;
			  // The firebase.auth.AuthCredential type that was used.
			  var credential = error.credential;
			  //showPopup(errorMessage);
			setCookie("uid", pn, 30);
			window.location.href = "index.html";
			});
		}
	</script>
	
	<!-- CSS for popup message ==============================================================-->
	<style>
		/* The Modal (background) */
		.modal {
			display: none; /* Hidden by default */
			position: fixed; /* Stay in place */
			z-index: 1; /* Sit on top */
			padding-top: 100px; /* Location of the box */
			left: 0;
			top: 0;
			width: 100%; /* Full width */
			height: 100%; /* Full height */
			overflow: auto; /* Enable scroll if needed */
			background-color: rgb(0,0,0); /* Fallback color */
			background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
		}

		/* Modal Content */
		.modal-content {
			background-color: #fefefe;
			margin: auto;
			padding: 20px;
			border: 1px solid #888;
			width: 80%;
		}

		/* The Close Button */
		.close {
			color: #aaaaaa;
			float: right;
			font-size: 28px;
			font-weight: bold;
		}

		.close:hover,
		.close:focus {
			color: #000;
			text-decoration: none;
			cursor: pointer;
		}
	</style>
	
	<!-- Popup message ==============================================================-->
	<div id="myPopup" class="modal">
	  <!-- Modal content -->
	  <div class="modal-content">
		<center><p id="message"></p></center>
	  </div>
	</div>
	
	<!-- Action for popup message =================================================-->
	<script>
		// Get the modal
		var modal = document.getElementById('myPopup');

		// Get message
		var message = document.getElementById('message');

		// When the user clicks the button, open the modal 
		function showPopup(text) {
			modal.style.display = "block";
			message.innerHTML = text
		}

		// When the user clicks anywhere outside of the modal, close it
		window.onclick = function(event) {
			if (event.target == modal) {
				modal.style.display = "none";
			}
		}
	</script>
</body>
</html>